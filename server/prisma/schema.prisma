generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int      @id @default(autoincrement())
  githubId Int?     @unique
  username String?  @unique
  password String?
  profile  Profile?
}

model UserNetwork {
  followerId  Int
  followingId Int
  assignedAt  DateTime @default(now())
  follower    Profile  @relation("follower", fields: [followerId], references: [userId])
  following   Profile  @relation("following", fields: [followingId], references: [userId])

  @@id([followerId, followingId])
}

model FollowRequest {
  requesterId Int
  createdAt   DateTime @default(now())
  targetId    Int
  requester   Profile  @relation("requester", fields: [requesterId], references: [userId], onDelete: Cascade)
  target      Profile  @relation("target", fields: [targetId], references: [userId], onDelete: Cascade)

  @@id([targetId, requesterId], name: "requestId")
}

model Profile {
  // A user can have 0 or more followers/followings
  userId    Int             @id @unique
  firstName String          @db.VarChar(50)
  lastName  String          @db.VarChar(50)
  title     String?
  bio       String?
  comments  Comment[]
  requests  FollowRequest[] @relation("requester")
  targets   FollowRequest[] @relation("target")
  posts     Post[]
  user      User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  reaction  Reactions[]
  followers UserNetwork[]   @relation("follower")
  following UserNetwork[]   @relation("following")
}

model Post {
  // If you do not specify a referential action, Prisma ORM uses the following defaults:
  // onDelete:	(optional relations) -> SetNull,	(required) -> Restrict
  // onUpdate:	(optional relations) -> Cascade,  (required) ->	Cascade
  id         Int         @id @default(autoincrement())
  title      String
  message    String?
  createdAt  DateTime    @default(now()) @db.Timestamptz(0)
  updatedAt  DateTime    @updatedAt
  published  Boolean     @default(false)
  authorId   Int?
  categoryId Int?
  comments   Comment[]
  author     Profile?    @relation(fields: [authorId], references: [userId])
  category   Category?   @relation(fields: [categoryId], references: [id])
  reactions  Reactions[]
}

model Category {
  id    Int    @id @default(autoincrement())
  name  String @unique @db.VarChar(50)
  posts Post[]
}

model Comment {
  id        Int      @id @default(autoincrement())
  path      String   @unique @db.VarChar(255)
  depth     Int
  numchild  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  message   String
  postId    Int
  authorId  Int
  isDeleted Boolean  @default(false)
  author    Profile  @relation(fields: [authorId], references: [userId], onDelete: Cascade)
  post      Post     @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([path])
}

model Reacts {
  id        Int         @id @default(autoincrement())
  name      String
  reactions Reactions[]
}

model Reactions {
  id        Int      @id @default(autoincrement())
  reactId   Int
  postId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  reactorId Int
  post      Post     @relation(fields: [postId], references: [id])
  react     Reacts   @relation(fields: [reactId], references: [id])
  reactor   Profile  @relation(fields: [reactorId], references: [userId])
}

model Session {
  id        String   @id
  sid       String   @unique
  data      String
  expiresAt DateTime
}
